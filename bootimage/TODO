$Id: TODO,v 1.8 2004/06/29 23:33:57 fare Exp $

Kernel 2.4
* move on, dude!
* maybe fix issues (that may reappear in 2.6?):
 * the APM kill-the-machine-if-kapmd-killed bug if still present
 * make the cursor visible by default

Kernel 2.6
* find out why the ramdisk doesn't load
* port the keyboard driver
* port the sa1101 driver
* port and fix the apm driver
* port and fix the PCMCIA driver
* ensure that backlight control works on fb
* fix the above issues from kernel 2.4 if they are still there.
* make the USB driver work
* make the sound driver work
* play nicer with booting to/from WinCE
* get external VGA working and/or some swap-on-VRAM
* get modem working?
* get some spiffy 802.11g card working!

Bootdisk
* have pcmcia and busybox from CVS.
* include kernel 2.6 module support in busybox configuration.
* ensure busybox sh correctly reads /etc/profile at startup.
* use early-userspace on kernel 2.6 ???

Userland
* gather a sensible base for userland (?)
* maybe based on OE? on uwoody?

Web site
* have a cron job update the web site from CVS.

Bootloader
* build a gcc toolchain for arm-wince-pe ???
* import and merge latest hpcboot sources from Oleg and NetBSD ???

------>8------>8------>8------>8------>8------>8------>8------>8------>8------
apm: do something
2.4 => kernel/arch/arm/mach-sa1100/apm.c
2.6 => kernel/arch/arm/mach-sa1100/jornada820.c
   kernel/arch/arm/kernel/apm.c
new apm_power_info structure

--- arch/arm/mach-sa1100/apm.c  22 Feb 2004 03:41:28 -0000
   1.1.1.1
+++ arch/arm/mach-sa1100/apm.c  4 Mar 2004 08:45:07 -0000       1.2
@@ -168,6 +168,9 @@
 #ifdef CONFIG_IPAQ_HANDHELD
             h3600_apm_get_power_status(ac_line_status,
   battery_status, battery_
flag, battery_percentage, battery_life);
 #endif
+#ifdef CONFIG_SA1100_JORNADA820
+            j820_apm_get_power_status(ac_line_status, battery_status,
   battery_f
lag, battery_percentage, battery_life);
+#endif
        return APM_SUCCESS;
 }

------>8------>8------>8------>8------>8------>8------>8------>8------>8------
video/sa1100fb.c

ensure that somewhere in
extern void (*sa1100fb_backlight_power)(int on);
there is

#ifdef CONFIG_SA1100_JORNADA820	
        GPSR = GPIO_JORNADA820_BACKLIGHTON;
#endif

------>8------>8------>8------>8------>8------>8------>8------>8------>8------
arch/arm/mach-sa1100/sa1101.c
update IRQ handling to new API... read Documentation/arm/Interrupts
avoid use of irq_desc and use request_irq() instead???
call set_irq_flags(irq,IRQF_VALID|...)???

------>8------>8------>8------>8------>8------>8------>8------>8------>8------
pcmcia:
in sa1100.h find out what happened to
extern struct pcmcia_low_level jornada820_pcmcia_ops;

drivers/pcmcia/sa1100_generic.c:74: error: `pcmcia_jornada820_init' undeclared here (not in a function)
drivers/pcmcia/sa1100_generic.c:74: error: initializer element is not constant
drivers/pcmcia/sa1100_generic.c:74: error: (near initialization for `sa11x0_pcmcia_hw_init[0]')
make[2]: *** [drivers/pcmcia/sa1100_generic.o] Error 1

drivers/pcmcia/sa1100_jornada820.c:23: warning: `struct pcmcia_state_array' declared inside parameter list
drivers/pcmcia/sa1100_jornada820.c:23: warning: its scope is only this definition or declaration, which is probably not what you want
drivers/pcmcia/sa1100_jornada820.c: In function `jornada820_pcmcia_socket_state':
drivers/pcmcia/sa1100_jornada820.c:26: error: dereferencing pointer to incomplete type

------>8------>8------>8------>8------>8------>8------>8------>8------>8------
drivers/char/keyboard.c:1011:2: warning: #warning "Cannot generate rawmode keyboard for your architecture yet."

j820kbd.c:
convert to 2.6 style
make a serio/sa1101ps2.c ???
what about the mouse ???

------>8------>8------>8------>8------>8------>8------>8------>8------>8------
Why are we experiencing problems with uncompressing a compressed ramdiskimage,
whereas we used not to? Maybe upstream bug? Maybe a build glitch?
For kernel 2.4, somehow we can survive with a non-compressed
   ramdiskimage, or sometimes by rebuilding. Why is there this bug?
For kernel 2.6, maybe we should investigate what happens with kinit...
	http://tree.celinuxforum.org/pubwiki/moin.cgi/EarlyUserSpace
	Documentation/early-userspace/README
Somehow with 2.6, the kernel says
"checking if image is initramfs...it isn't (ungzip failed); looks like
   an initrd
Freeing initrd memory: 4096K"
There's a bug to be traced in init/do_mounts_rd.c or init/initramfs.c
-- somehow, the ramdisk isn't loaded properly.
Using md5sum to check that the compressed then uncompressed disk
images are there might or mightn't be useful in locating the bug.

Tracing do_mounts_rd.c, we find that in rd_load_image, the following
statement exits.
	nblocks = identify_ramdisk_image(in_fd, rd_image_start);
	if (nblocks < 0)
		goto done;

Tracing what is going wrong when loading the initrd on the j820, 
I find in identify_ramdisk_image that initrd.image has been written 
with parts of the linux kernel instead of the ramdisk. 
I guess some memory address loading parameters are wrong in a
   Makefile.

OK, so the initrd was being overwritten by the bss of the decompressor. Bad!

------>8------>8------>8------>8------>8------>8------>8------>8------>8------
